{% extends "base.html" %}
{#{% block title %}Забастовки{% endblock %}#}

{#{% block scripts %}#}
{#    <!-- block.super will get the content of the block from the parent template -->#}
{#    {{ block.super }}#}
{#    <script src="{% static 'strike/js/script.js' %}"></script>#}
{#{% endblock %}#}

{% block content %}
<script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    {% block toggle %}
        {{ block.super }}
        <ul class="nav navbar-nav navbar-right">
            <li><a href="{% url 'strikes_list' %}">Список забастовок</a></li>
        </ul>
    {% endblock %}

<div id = "test"></div>
<script type="text/babel">

    class App extends React.Component {

        constructor(props) {
            super(props);
            this.state = {
                countries: this.props.countries,
                country: this.props.countries[0].v,
                token: this.props.token,
                isActive: this.props.isActive || false,
                name: this.props.name || '',
                cardSources: this.props.cardSources || [],
                source_url: this.props.source_url || '',
                source_content: this.props.source_content || '',
                regions: this.props.regions || [],
                city_name: this.props.city_name || '',
                company_name: this.props.company_name || '',
                ownerships: this.props.ownerships,
                company_ownership_type: this.props.ownerships[0].pk,
                company_country_name: this.props.company_country_name || '',
                company_is_tnk_member: this.props.company_is_tnk_member || false,
                company_tnk_name: this.props.company_tnk_name || '',
                company_employees_counts: this.props.employeeCounts,
                company_employees_count: this.props.employeeCounts[0].pk,
                counts_strike_participants: this.props.participantsCounts,
                count_strike_participants: this.props.participantsCounts[0].v,
                tradeunionChoices: this.props.hasTradeUnionChoices,
                tradeunionChoice: this.props.hasTradeUnionChoices[0].pk,
                initiators: this.props.initiators,
                initiator: this.props.initiators[0].v,
                person_groups: this.props.person_groups,
                person_group: this.props.person_groups[0].pk,
                person_characters: this.props.person_characters,
                person_character: this.props.person_characters[0].pk,
                person_group_another: this.props.person_group_another || '',
                durations: this.props.durations,
                duration: this.props.durations[0].pk,
                meeting_requirements: this.props.meeting_requirements,
                meeting_requirement: this.props.meeting_requirements[0].pk,
                card_demand_categories: this.props.demandCategories.map(v => false),

                demandTypes: this.props.demandTypes,
                demandCategories: this.props.demandCategories,

            };


            [
                { label: 'Укажите ПОСЛЕДОВАТЕЛЬНО, что произошло', name: 'story' },
                { label: 'Причины начала забастовки', name: 'reasons_for_strike' },
                { label: 'Как менялось количество участников забастовки', name: 'change_number_participants' },
                { label: 'Что с инициаторами и участниками', name: 'id_initiators_and_participants' },
                { label: 'Позиция государства (Опишите реакцию государственных органов)', name: 'state_position' },
                { label: 'C какими итогами закончилась забастовка, если еще не закончилась, то какие итоги на данный момент', name: 'results_so_far' },
                { label: 'Любая дополнительная информация', name: 'additional_information' },
                { label: 'Кейсы, связанные с забастовкой', name: 'case_text' }
            ].map(v => this.state[v.name] = '');

            this.state.card_sources_cb = this.props.cardSources.map(v => v.pk);
        }

        handleChange(e, field, parent = null) {

            let isCheckbox = e.target.type === 'checkbox';

            if(parent === null) {
                this.setState({
                    [field]: isCheckbox ? e.target.checked : e.target.value
                });
            }
            else
            {
                let parentNode = this.state[parent];
                parentNode[field] = isCheckbox ? e.target.checked : e.target.value;
                this.setState({
                    [parent]: parentNode
                });
            }
        }



        render() {
            return (
                <form method="POST">
                    <input
                        type="hidden"
                        name="csrfmiddlewaretoken"
                        value={this.state.token}
                        onChange={e => this.handleChange(e, 'token')}
                    />
                    <br/>
                    <label>
                        <input
                            type="text"
                            onChange={e => this.handleChange(e, 'name')}
                            name="name"
                            required
                            placeholder="Название"
                        />
                    </label>
                    <br/>

                    <div className="form-group">

                        <label>Источник:</label>

                        <br/>
                        <ul className="checkbox-list-none">
                            {
                                this.state.cardSources.map((v, i) => (
                                        <li key = {i}>
                                            <label>
                                                <input
                                                    key={v.pk}
                                                    type="checkbox"
                                                    name="card_sources"
                                                    value={v.pk}
                                                    className="checkbox-list-none"
                                                    onChange={e => this.handleChange(
                                                        e, i, 'card_sources_cb'
                                                    )}
                                                    checked={v.checked}
                                                />
                                                {v.fields.name}
                                            </label>

                                        </li>
                                    )
                                )
                            }
                        </ul>
                    </div>
                    <div
                        className="form-group"
                        style={{
                            display:
                                (() => {
                                    let cs = this.state.cardSources.find(
                                        (v, i) =>
                                            v.fields.name === 'СМИ/Блогер/Лидер мнения' &&
                                            this.state.card_sources_cb[i] === true
                                    )
                                    return !!cs;
                                })()
                                    ? 'block' : 'none'
                        }}
                    >

                        <label>Источник информации (ссылка):
                            <br/>
                            <input
                                type="url"
                                name="source_url"
                                className="form-control"
                                maxLength="255"
                                onChange={e => this.handleChange(e, 'source_url')}
                            />
                        </label>
                        <div className="invalid_feedback">

                        </div>
                    </div>

                    <div
                        className="form-group"
                        style={{
                            display:
                                (() => {
                                    let cs = this.state.cardSources.find(
                                        (v, i) =>
                                            v.fields.name === 'СМИ/Блогер/Лидер мнения' &&
                                            this.state.card_sources_cb[i] === true
                                    )
                                    return !!cs;
                                })()
                                    ? 'block' : 'none'
                        }}
                    >
                        <label>Текст статьи/сообщения :

                            <br/>
                            <textarea
                                name="source_content"
                                cols="40"
                                rows="10"
                                className="form-control"
                                id="id_source_content"
                                onChange={e => this.handleChange(e, 'source_content')}
                            />
                            <div className="invalid_feedback">

                            </div>
                        </label>
                    </div>

                    <div className="form-group">

                        <label>
                            <select
                                value={this.state.country}
                                onChange={e => this.handleChange(e, 'country')}
                                name="country"
                            >
                                {
                                    this.state.countries.map(v =>
                                        <option value={v.pk} key={v.pk}>{v.fields.name}</option>
                                    )
                                }
                            </select>
                        </label>
                    </div>


                    <div className="form-group">

                        <label>
                            Регион:
                            <select
                                value={this.state.region}
                                onChange={e => this.handleChange(e, 'region')}
                                name="region"
                            >
                                {
                                    this.state.regions.map(v =>
                                        <option value={v.pk} key={v.pk}>{v.fields.name}</option>
                                    )
                                }
                            </select>
                        </label>
                    </div>

                    <div className="form-group">

                        <label>Название города:

                            <br/>
                            <input
                                type="text"
                                name="city_name"
                                value={this.state.city_name}
                                className="form-control"
                                maxLength="100"
                                required
                                onChange={e => this.handleChange(e, 'city_name')}
                            />
                        </label>
                    </div>


                    <div className="form-group">

                        <label>Название предприятия (юридического лица):

                            <br/>
                            <input
                                type="text"
                                name="company_name"
                                value={this.state.company_name}
                                className="form-control"
                                maxLength="100"
                                required
                                onChange={e => this.handleChange(e, 'company_name')}
                            />
                        </label>
                    </div>


                    <div className="form-group">

                        <label>
                            Форма собственности компании:
                            <br/>
                            <select
                                value={this.state.company_ownership_type}
                                onChange={e => this.handleChange(e, 'company_ownership_type')}
                                name="ownership"
                            >
                                {
                                    this.state.ownerships.map(v =>
                                        <option value={v.pk} key={v.pk}>{v.fields.name}</option>
                                    )
                                }
                            </select>
                        </label>
                    </div>

                    <div
                         className="form-group"
                         style={{
                             display:
                                 this.state.ownerships.find(
                                     v => v.pk === +this.state.company_ownership_type
                                 ).fields.name === 'Иностранная'
                                     ? 'block' : 'none'
                         }}
                    >

                        <label>Страна происхождения компании:

                            <br/>
                            <input
                                type="text"
                                name="company_name"
                                value={this.state.company_country_name}
                                className="form-control"
                                maxLength="100"
                                required
                                onChange={e => this.handleChange(e, 'company_country_name')}
                            />
                        </label>
                    </div>

                    <div className="form-group"
                         style={{
                             display:
                                 this.state.ownerships.find(
                                     v => v.pk === +this.state.company_ownership_type
                                 ).fields.name === 'Иностранная'
                                     ? 'block' : 'none'
                         }}>

                        <label>
                            Является ли эта кампания частью ТНК (Транснациональная компания):
                            <br/>
                            <input
                                type="checkbox"
                                name="company_is_tnk_member"
                                className="form-check-label"
                                onChange={e => this.handleChange(e, 'company_is_tnk_member')}
                                checked={this.state.company_is_tnk_member}
                            />
                            <div className="invalid_feedback">

                            </div>
                        </label>
                    </div>

                    <div
                        className="form-group"
                        style = {{
                            display: this.state.ownerships.find(
                                v => v.pk === +this.state.company_ownership_type
                            ).fields.name === 'Иностранная' && this.state.company_is_tnk_member
                                ? 'block' : 'none'
                        }}
                    >

                        <label>Название ТНК (Транснациональная компания)::

                            <br/>
                            <input
                                type="text"
                                name="company_tnk_name"
                                value={this.state.company_tnk_name}
                                className="form-control"
                                maxLength="100"
                                required
                                onChange={e => this.handleChange(e, 'company_tnk_name')}
                            />
                        </label>
                    </div>

                    <div className="form-group">

                        <label>
                            Общая численность работников на предприятии:
                            <br/>
                            <select
                                value={this.state.company_employees_count}
                                onChange={e => this.handleChange(e, 'company_employees_count')}
                                name="company_employees_count"
                            >
                                {
                                    this.state.company_employees_counts.map(v =>
                                        <option value={v.pk} key={v.pk}>{v.fields.choice}</option>
                                    )
                                }
                            </select>
                        </label>
                    </div>

                    <div className="form-group">

                        <label>
                            Количество участников забастовки/акции:
                            <br/>
                            <select
                                value={this.state.count_strike_participants}
                                onChange={e => this.handleChange(e, 'count_strike_participants')}
                                name="count_strike_participants"
                            >
                                {
                                    this.state.counts_strike_participants.map(v =>
                                        <option value={v.pk} key={v.pk}>{v.fields.choice}</option>
                                    )
                                }
                            </select>
                        </label>
                    </div>

                    <div className="form-group">
                        {
                            this.props.demandTypes.map((v, i) =>
                                <div key={i} >
                                    <h6>{v.fields.demand}</h6>
                                    <ul key={i.toString() + i.toString()} className="checkbox-list-none">
                                        {
                                            this.state.demandCategories.filter(
                                                v1 => v.pk === v1.fields.demand_type
                                            ).map((v2, i2) =>
                                                <li key={i2}>
                                                    <label>
                                                        <input
                                                            type="checkbox"
                                                            name="card_demand_categories"
                                                            className="checkbox-list-none"
                                                            checked={this.state.card_demand_categories[v2.pk]}
                                                            value={v2.pk}
                                                            onChange={e =>
                                                                this.handleChange(
                                                                    e,
                                                                    v2.pk,
                                                                    'card_demand_categories'
                                                                )
                                                            }
                                                        />
                                                        {v2.fields.name}
                                                    </label>
                                                </li>
                                            )
                                        }
                                    </ul>
                                </div>
                            )
                        }
                    </div>


                    <div className="form-group">

                        <label>
                            Есть ли на предприятии профсоюз:
                            <br/>
                            <select
                                value={this.state.tradeunionChoice}
                                onChange={e => this.handleChange(e, 'tradeunionChoice')}
                                name="tradeunionChoice"
                            >
                                {
                                    this.state.tradeunionChoices.map(v =>
                                        <option value={v.pk} key={v.pk}>{v.fields.value}</option>
                                    )
                                }
                            </select>
                        </label>
                    </div>


                    <div
                        className="form-group"
                        style={{
                            display:
                                this.state.tradeunionChoices.find(
                                    v => v.pk === +this.state.tradeunionChoice
                                ).fields.value === 'Другое'
                                    ? 'block' : 'none'
                        }}
                    >
                        <label>
                            <input
                                type="text"
                                // onChange={e => this.handleChange(e, 'person_group_another')}
                                // name="person_group_another"
                                // value={this.state.person_group_another}
                                placeholder="Другое"
                            />
                        </label>
                    </div>

                    <div className="form-group">

                        <label>
                            Активен:
                            <br/>
                            <input
                                type="checkbox"
                                name="company_is_tnk_member"
                                className="form-check-label"
                                onChange={e => this.handleChange(e, 'company_is_tnk_member')}
                                checked={this.state.company_is_tnk_member}
                            />
                            <div className="invalid_feedback">

                            </div>
                        </label>
                    </div>



                    <div className="form-group">

                        <label>
                            Инициатор забастовки/акции:
                            <br/>
                            <select
                                value={this.state.initiator}
                                onChange={e => this.handleChange(e, 'initiator')}
                                name="initiator"
                            >
                                {
                                    this.state.initiators.map(v =>
                                        <option value={v.pk} key={v.pk}>{v.fields.name}</option>
                                    )
                                }
                            </select>
                        </label>
                    </div>

                    <div className="form-group">

                        <label>
                            Группа лиц:
                            <br/>
                            <select
                                value={this.state.person_group}
                                onChange={e => this.handleChange(e, 'person_group')}
                                name="person_group"
                            >
                                {
                                    this.state.person_groups.map(v =>
                                        <option value={v.pk} key={v.pk}>{v.fields.value}</option>
                                    )
                                }
                            </select>
                        </label>
                    </div>


                    <div className="form-group">

                        <label>
                            Характер группы:
                            <br/>
                            <select
                                value={this.state.person_character}
                                onChange={e => this.handleChange(e, 'person_character')}
                                name="person_character"
                            >
                                {
                                    this.state.person_characters.filter(v =>
                                        v.fields.person_group === +this.state.person_group
                                    ).map(v =>
                                        <option value={v.pk} key={v.pk}>{v.fields.value}</option>
                                    )
                                }
                            </select>
                        </label>
                    </div>


                    <div
                        className="form-group"
                        style={{
                            display:
                                this.state.person_characters.find(
                                    v => v.pk === +this.state.person_character
                                ).fields.value === 'Другое'
                                ? 'block' : 'none'
                        }}
                    >
                        <label>
                            <input
                                type="text"
                                onChange={e => this.handleChange(e, 'person_group_another')}
                                name="person_group_another"
                                value={this.state.person_group_another}
                                placeholder="Другое"
                            />
                        </label>
                    </div>


                    <div className="form-group">
                        <label>
                            Длительность забастовки/акции:
                            <br/>
                            <select
                                value={this.state.duration}
                                onChange={e => this.handleChange(e, 'duration')}
                                name="duration"
                            >
                                {
                                    this.state.durations.map(v =>
                                        <option value={v.pk} key={v.pk}>{v.fields.value}</option>
                                    )
                                }
                            </select>
                        </label>
                    </div>


                    <div className="form-group">

                        <label>
                            Удовлетворение требований:
                            <br/>
                            <select
                                value={this.state.meeting_requirement}
                                onChange={e => this.handleChange(e, 'meeting_requirement')}
                                name="meeting_requirements"
                            >
                                {
                                    this.state.meeting_requirements.map(v =>
                                        <option value={v.pk} key={v.pk}>{v.fields.value}</option>
                                    )
                                }
                            </select>
                        </label>
                    </div>

                    {
                        [
                            { label: 'Укажите ПОСЛЕДОВАТЕЛЬНО, что произошло', name: 'story' },
                            { label: 'Причины начала забастовки', name: 'reasons_for_strike' },
                            { label: 'Как менялось количество участников забастовки', name: 'change_number_participants' },
                            { label: 'Что с инициаторами и участниками', name: 'initiators_and_participants' },
                            { label: 'Позиция государства (Опишите реакцию государственных органов)', name: 'state_position' },
                            { label: 'C какими итогами закончилась забастовка, если еще не закончилась, то какие итоги на данный момент', name: 'results_so_far' },
                            { label: 'Любая дополнительная информация', name: 'additional_information' },
                            { label: 'Кейсы, связанные с забастовкой', name: 'case_text' }
                        ].map(v =>
                            <div  key={v.name} className="form-group">

                                <label>
                                    {v.label} :
                                    <br/>
                                    <textarea
                                        required
                                        name={v.name}
                                        cols="40"
                                        rows="10"
                                        className="form-control"
                                        onChange={e => this.handleChange(e, v.name)}
                                    />
                                    <div className="invalid_feedback">

                                    </div>
                                </label>
                            </div>

                        )
                    }

                    <button type="submit">Send</button>
                </form>
            );
        }

    }
    ReactDOM.render(
        <App

            cardSources = { [{"model": "strike.source", "pk": 0, "fields": {"name": "СМИ/Блогер/Лидер мнения", "active": true}}, {"model": "strike.source", "pk": 1, "fields": {"name": "Работники/участники протеста", "active": true}}, {"model": "strike.source", "pk": 2, "fields": {"name": "Профсоюз", "active": true}}, {"model": "strike.source", "pk": 3, "fields": {"name": "Представитель коллектива", "active": true}}, {"model": "strike.source", "pk": 4, "fields": {"name": "Государственные органы", "active": true}}, {"model": "strike.source", "pk": 5, "fields": {"name": "Не правительственные организации /гражданские активисты", "active": true}}] }

            initiators = { [{"model": "strike.initiator", "pk": 0, "fields": {"name": "Профсоюз"}}, {"model": "strike.initiator", "pk": 1, "fields": {"name": "Группа лиц"}}, {"model": "strike.initiator", "pk": 2, "fields": {"name": "Физическое лицо"}}] }

            countries = { [{"model": "strike.country", "pk": 0, "fields": {"name": "Россия", "active": true}}, {"model": "strike.country", "pk": 1, "fields": {"name": "Кыргызстан", "active": true}}, {"model": "strike.country", "pk": 2, "fields": {"name": "Казахстан", "active": true}}] }
            regions = { [{"model": "strike.region", "pk": 0, "fields": {"name": "г. Москва", "active": true, "country": 0}}] }
            ownerships = { [{"model": "strike.ownershiptype", "pk": 0, "fields": {"name": "Национальная, государственная", "active": true}}, {"model": "strike.ownershiptype", "pk": 1, "fields": {"name": "Национальная, частная", "active": true}}, {"model": "strike.ownershiptype", "pk": 2, "fields": {"name": "Смешанная", "active": true}}, {"model": "strike.ownershiptype", "pk": 3, "fields": {"name": "Иностранная", "active": true}}] }
            demandCategories = { [{"model": "strike.demandcategory", "pk": 0, "fields": {"name": "Оплата труда", "demand_type": 0, "active": true}}, {"model": "strike.demandcategory", "pk": 1, "fields": {"name": "Охрана труда и здоровье", "demand_type": 0, "active": true}}, {"model": "strike.demandcategory", "pk": 2, "fields": {"name": "Вопросы занятости уволенных/сокращенных работников, безработных", "demand_type": 0, "active": true}}, {"model": "strike.demandcategory", "pk": 3, "fields": {"name": "Сокращение рабочего времени", "demand_type": 0, "active": true}}, {"model": "strike.demandcategory", "pk": 4, "fields": {"name": "Другое", "demand_type": 0, "active": true}}, {"model": "strike.demandcategory", "pk": 5, "fields": {"name": "Смена руководства предприятия", "demand_type": 1, "active": true}}, {"model": "strike.demandcategory", "pk": 6, "fields": {"name": "Смена руководителей исполнительной власти", "demand_type": 1, "active": true}}, {"model": "strike.demandcategory", "pk": 7, "fields": {"name": "Проведение политических реформ в стране", "demand_type": 1, "active": true}}, {"model": "strike.demandcategory", "pk": 8, "fields": {"name": "Другое", "demand_type": 1, "active": true}}, {"model": "strike.demandcategory", "pk": 9, "fields": {"name": "Требования связанные с профсоюзной деятельностью", "demand_type": 2, "active": true}}, {"model": "strike.demandcategory", "pk": 10, "fields": {"name": "Другое", "demand_type": 2, "active": true}}] }
            demandTypes = { [{"model": "strike.demandtype", "pk": 0, "fields": {"demand": "Экономический", "active": true}}, {"model": "strike.demandtype", "pk": 1, "fields": {"demand": "Политический", "active": true}}, {"model": "strike.demandtype", "pk": 2, "fields": {"demand": "Смешанный", "active": true}}] }
            employeeCounts = { [{"model": "strike.employeescount", "pk": 0, "fields": {"choice": "до 50 человек", "active": true}}, {"model": "strike.employeescount", "pk": 1, "fields": {"choice": "от 50 до 200 человек", "active": true}}, {"model": "strike.employeescount", "pk": 2, "fields": {"choice": "от 200 до 1500 человек", "active": true}}, {"model": "strike.employeescount", "pk": 3, "fields": {"choice": "более 1500 человек", "active": true}}] }
            participantsCounts = { [{"model": "strike.participantscount", "pk": 0, "fields": {"choice": "менее 10 человек", "active": true}}, {"model": "strike.participantscount", "pk": 1, "fields": {"choice": "10-50 человек", "active": true}}, {"model": "strike.participantscount", "pk": 2, "fields": {"choice": "51-100 человек", "active": true}}, {"model": "strike.participantscount", "pk": 3, "fields": {"choice": "101-1000 человек", "active": true}}, {"model": "strike.participantscount", "pk": 4, "fields": {"choice": "более 1000 человек", "active": true}}] }
            hasTradeUnionChoices = { [{"model": "strike.tradeunionchoice", "pk": 0, "fields": {"value": "Да", "active": true}}, {"model": "strike.tradeunionchoice", "pk": 1, "fields": {"value": "Отсутствует", "active": true}}, {"model": "strike.tradeunionchoice", "pk": 2, "fields": {"value": "Неизвестно", "active": true}}, {"model": "strike.tradeunionchoice", "pk": 3, "fields": {"value": "Другое", "active": true}}] }
            person_groups = { [{"model": "strike.persongroup", "pk": 0, "fields": {"value": "Характер группы ", "active": true}}, {"model": "strike.persongroup", "pk": 1, "fields": {"value": "Членство в профсоюзе", "active": true}}] }

            durations = { [{"model": "strike.strikecharacter", "pk": 0, "fields": {"value": "кратковременная", "active": true}}, {"model": "strike.strikecharacter", "pk": 1, "fields": {"value": "длящаяся", "active": true}}] }
            meeting_requirements = { [{"model": "strike.meetingrequirment", "pk": 0, "fields": {"value": "удовлетворены", "active": true}}, {"model": "strike.meetingrequirment", "pk": 1, "fields": {"value": "не удовлетворены", "active": true}}, {"model": "strike.meetingrequirment", "pk": 2, "fields": {"value": "удовлетворены частично", "active": true}}] }

            person_characters = { [{"model": "strike.groupcharacter", "pk": 0, "fields": {"value": "Бригада или производственная группа", "active": true, "person_group": 0}}, {"model": "strike.groupcharacter", "pk": 1, "fields": {"value": "Определенная категория работников", "active": true, "person_group": 0}}, {"model": "strike.groupcharacter", "pk": 2, "fields": {"value": "Другое", "active": true, "person_group": 0}}, {"model": "strike.groupcharacter", "pk": 3, "fields": {"value": "Все состоят в профсоюзе", "active": true, "person_group": 1}}, {"model": "strike.groupcharacter", "pk": 4, "fields": {"value": "В профсоюзе состоят не все", "active": true, "person_group": 1}}, {"model": "strike.groupcharacter", "pk": 5, "fields": {"value": "Никто не состоит в профсоюзе", "active": true, "person_group": 1}}] }

            token = "zUXNGcYfFuB6ERkmgz4AyFFlWdH2C5Xt0lJ1B5qW7gnVRuhBMwXkHOOXhN229pov"
            cleaned_data = { [] }

        />,
        document.querySelector('#test')
    );
</script>
{% endblock %}
